"use strict";var ComboChart={version:"0.1"};ComboChart.ChartArea=function(t,e){function r(t){var e;switch(t){case"linear":var e=d3.scale.linear();break;case"time":var e=d3.time.scale();break;case"sqrt":var e=d3.scale.sqrt();break;case"pow":var e=d3.scale.pow();break;case"log":var e=d3.scale.log()}return e}function a(t,e){return N.push([t,e]),N.length-1}function n(t,e){for(var r=[],a=0;a<N.length;a++){var n;n=void 0!=e&&a==e?t:N[a][0](N[a][1]);for(var i=0;4>i;i++)i%2==0?(void 0==r[i]||r[i]>n[i])&&(r[i]=n[i]):(void 0==r[i]||r[i]<n[i])&&(r[i]=n[i])}return r}function i(){m=r(c).domain([b[0],b[1]]).range([p,v]),w=r(g).domain([b[2],1.15*b[3]]).range([y,p])}function l(){k.scale(m),z.scale(w),A.call(k),T.call(z),A.selectAll("line").style({fill:"none",stroke:"#dbdbdb","shape-rendering":"crispEdges"});var t,e=!1;A.selectAll("text").style({"text-anchor":"middle"}).attr("transform","rotate(0)"),A.selectAll("text").each(function(){var r=this.getBoundingClientRect();if(void 0==t)t=r;else{if(t.right>r.left-2)return e=!0,!1;t=r}}),1==e&&A.selectAll("text").style({"text-anchor":"end"}).attr("dx","-.2em").attr("dy",".4em").attr("transform","rotate(-65)"),T.selectAll("line").style({fill:"none",stroke:"#dbdbdb","shape-rendering":"crispEdges"})}function o(t){if(0==L.length)L.push(t);else for(var e=0;e<=L.length;e++)if(e==L.length||L[e][1]>t[1]){L.splice(e,0,t);break}}function s(t){for(var e=0;e<L.length;e++)L[e][0](t)}var d=document.getElementById(t),e=e||{},p=e.padding||60,h=e.width||400,f=e.height||600,u=e.font||"arial, sans-serif",c=(e.xGridEnabled||!0,e.yGridEnabled||!0,e.xScaleType||"linear"),g=e.yScaleType||"linear",x=(e.zoomEnabled||!1,d3.select(d).append("svg").attr("width",h).attr("height",f)),v=h-p,y=f-p,b=[],m=r(c).domain([b[0],b[1]]).range([p,v]),w=r(g).domain([b[2],b[3]]).range([y,p]),k=d3.svg.axis().scale(m).orient("bottom").innerTickSize(-(y-p)).outerTickSize(0),z=d3.svg.axis().scale(w).orient("left").innerTickSize(-(v-p)).outerTickSize(0),A=x.append("g").attr("transform","translate(0,"+y+")").call(k).style({"-webkit-touch-callout":"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","font-family":u,"font-size":"12px"}),T=x.append("g").attr("transform","translate("+p+",0)").call(z).style({"-webkit-touch-callout":"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","font-family":u,"font-size":"12px"}),B=x.append("g").attr("clip-path","url(#ccLinePlotAreaClip)");B.append("clipPath").attr("id","ccLinePlotAreaClip").append("rect").attr("x",p).attr("y",p).attr("width",v-p).attr("height",y-p);B.append("rect").attr("x",p).attr("y",p).attr("width",v-p).attr("height",y-p).attr("stroke","#dbdbdb").attr("stroke-width",2).attr("fill","#ff0000").attr("fill-opacity",0);var L=[],C=[],N=[];this.getDomain=function(){return b},this.getSelectedData=function(){return C},this.createLineChart=function(t){function e(t){for(var e=[],r=0;r<t.length;r++){var a=d3.extent(t[r],function(t){return t[0]});(a[0]<e[0]||null==e[0]||void 0==e[0])&&(e[0]=a[0]),(a[1]>e[1]||null==e[1]||void 0==e[1])&&(e[1]=a[1]);var n=d3.extent(t[r],function(t){return t[1]});(n[0]<e[2]||null==e[2]||void 0==e[2])&&(e[2]=n[0]),(n[1]>e[3]||null==e[3]||void 0==e[3])&&(e[3]=n[1])}return e}function r(t){if(K=[],x.selectAll("path").remove(),x.selectAll("circle").remove(),l(),E)for(var e=0;e<A.length;e++){var r=B.append("svg:path").attr("d",Q(A[e])).attr("fill",T[e]).attr("opacity","0.3");U.push(r)}for(var e=0;e<A.length;e++){var r=[];r[0]=B.append("svg:path").attr("d",J(A[e])).attr("stroke",T[e]).attr("stroke-width",2).attr("fill","none"),"doughnut"==S?(r[2]=B.selectAll(".set"+e).data(A[e]).enter().append("circle").attr("class","set"+e).attr("cx",F).attr("cy",H).attr("r",6).attr("fill","#fff"),r[1]=B.selectAll(".inner"+e).data(A[e]).enter().append("circle").attr("class","inner"+e).attr("cx",F).attr("cy",H).attr("r",3).attr("fill","#fff").attr("stroke",T[e]).attr("stroke-width",2)):"none"==S||(r[1]=B.selectAll(".inner"+e).data(A[e]).enter().append("circle").attr("class","inner"+e).attr("cx",F).attr("cy",H).attr("r",3).attr("fill",T[e])),r[3]=B.selectAll(".tooltipArea"+e).data(A[e]).enter().append("circle").attr("class","tooltipArea"+e).attr("cx",F).attr("cy",H).attr("r",10).style("opacity",0).on("mouseover",function(t){}).on("mouseout",function(t){}),K.push(r)}}function h(){var t=B.append("line").style("stroke","black").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0);return t.update=function(e){t.style("stroke","#000").attr("class","hoverLine").attr("x1",e).attr("x2",e).attr("y1",p).attr("y2",y)},t.hide=function(){t.attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",0)},t}function f(){var t=B.append("line").style("stroke","black").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0);return t.update=function(e){var r=m.invert(e),a=u(r),n=m(A[a[1]][a[2]][0]);C=g(A[a[1]][a[2]][0]),t.style("stroke","#000").style("stroke-width",2).attr("x1",n).attr("x2",n).attr("y1",p).attr("y2",y)},t}function u(t){for(var e=[-1,-1,-1],r=0;r<A.length;r++){var a=[],n=0,i=A[r].length-1,l=Math.floor((n+i)/2);if(t<A[r][n][0])a=[-1*(t-A[r][n][0]),r,n];else if(t>A[r][i][0])a=[t-A[r][i][0],r,i];else{for(;i-n>1;)if(l=Math.floor((n+i)/2),t-A[r][l][0]>0)n=l;else if(t-A[r][l][0]<0)i=l;else if(t-A[r][l][0]==0)return e=[t-A[r][l][0],r,l];if(t-A[r][n][0]==0)return e=[t-A[r][n][0],r,n];if(-1*(t-A[r][i][0])==0)return e=[t-A[r][i][0],r,i];a=t-A[r][n][0]<-1*(t-A[r][i][0])?[t-A[r][n][0],r,n]:[-1*(t-A[r][i][0]),r,i]}(a[0]<e[0]||-1==e[0])&&(e=a)}return e}function g(t){for(var e=[],r=0;r<A.length;r++)for(var a=-1,n=A[r].length,i=Math.floor((a+n)/2);n-a>1;)if(i=Math.floor((a+n)/2),t-A[r][i][0]>0)a=i;else if(t-A[r][i][0]<0)n=i;else if(t-A[r][i][0]==0){var l=A[r][i].slice();l.splice(1,1),e.push(l);break}return e}function k(t){for(var e=[],r=0;r<A.length;r++)for(var a=-1,n=A[r].length,i=Math.floor((a+n)/2);n-a>1;)if(i=Math.floor((a+n)/2),t-A[r][i][0]>0)a=i;else if(t-A[r][i][0]<0)n=i;else if(t-A[r][i][0]==0){var l=[[r],[i]];e.push(l);break}return e}function z(){var t=d3.select("body").append("div").style({display:"flex","flex-direction":"row",position:"absolute","z-index":"10",opacity:0,font:"12px sans-serif","text-align":"left",padding:"4px","padding-left":"6px","padding-right":"0px","border-radius":"5px",width:"auto",height:"auto",background:"#fff","pointer-events":"none","box-shadow":"0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24)",border:"1px solid rgba(0, 0, 0, 0.24)"}),e=t.append("div").style({"z-index":"11","text-align":"left",width:"auto",height:"auto","padding-top":"14px",background:"#fff",border:"0px solid green","pointer-events":"none"}).append("svg").style("margin-top","1px").attr("width","10px"),r=t.append("div").style({"z-index":"11",font:"12px sans-serif","text-align":"left",width:"auto",height:"auto",background:"#fff","padding-left":"5px",border:"0px solid red",transform:"translate(0px, 0px)","pointer-events":"none"}),a=t.append("div").style({flex:"0",position:"absolute","z-index":"15",width:"0px",height:"0px",background:"none","border-right":"10px solid rgba(0, 0, 0, 0.4)","border-top":"10px solid transparent","border-bottom":"10px solid transparent","pointer-events":"none"});a.append("div").style({flex:"0",position:"absolute","z-index":"1",width:"0px",height:"0px",background:"none","border-right":"9px solid white","border-top":"9px solid transparent","border-bottom":"9px solid transparent","pointer-events":"none",transform:"translate(1px, -9px)"});return t.update=function(n){for(var i=m.invert(n[0]),l=u(i),o=k(A[l[1]][l[2]][0]),s=[],p=[],h=0;h<o.length;h++)p[h]=A[o[h][0]][o[h][1]][1];"time"==c?(i=i.toString(),i=i.slice(0,16)):i=Math.round(i);for(var f="",g=0;g<p.length;g++)f=f+L[o[g][0]]+": "+p[g]+"<br/>";f=i+"<br/>"+f,r.html(f),e.attr("height",14*p.length);for(var g=0;g<p.length;g++)s[g]=e.append("rect").attr("height",10).attr("width",10).attr("x","0px").attr("y",14*g+"px").attr("fill",T[o[g][0]]);var x=(Number(t.style("width").slice(0,-2)),Number(t.style("height").slice(0,-2))/2);a.style("left","-10px").style("top",x-4+"px");var v=d.getBoundingClientRect();t.style("left",v.left+n[0]+30+"px").style("top",v.top+n[1]-x-8+"px").style("opacity",.9).style("z-index","5")},t.hide=function(){t.style("opacity",0)},t}var t=t||{},A=t.data||[],T=t.colors||["#e21f1f","#0b5ed0","#1b7e09","#a10dce","#e26d09"],L=t.labels||["Line 1","Line 2","Line 3","Line 4","Line 5"],N=t.dataType||"total",S=t.pointStyle||"dot",D=t.interpolation||"linear",E=t.showArea||!1,M=t.layer||1,G=t.xLineSelection||!1,I=(t.pointSelection||!1,t.xCursorLine||!1),P=t.xPosTooltip||!1;if("total"==N)for(var X=0;X<A.length;X++)for(var O=0;O<A[X].length;O++){for(var q=0,R=1;R<A[X][O].length;R++)q+=A[X][O][R];A[X][O].splice(1,0,q)}if(isNaN(A[0][0][0]))for(var X=0;X<A.length;X++)for(var O=0;O<A[X].length;O++){var V=new Date(A[X][O][0]);V=new Date(V.getTime()+6e4*V.getTimezoneOffset()),A[X][O][0]=V}var Y,W,j,F=function(t){return m(t[0])},H=function(t){return w(t[1])},J=d3.svg.line().x(F).y(H).interpolate(D),K=[],Q=d3.svg.area().x(F).y0(y).y1(H),U=[];a(e,A);b=n(),i(),l(),o([r,M]),G&&(Y=f()),I&&(W=h()),P&&(j=z()),s(A),B.on("mouseover",function(){I&&W.update(d3.mouse(x.node())[0]),P&&j.update(d3.mouse(x[0][0]))}).on("mousemove",function(){I&&W.update(d3.mouse(x.node())[0]),P&&j.update(d3.mouse(x[0][0]))}).on("mouseout",function(){I&&W.hide(),P&&j.hide()}).on("mousedown",function(){G&&Y.update(d3.mouse(x.node())[0])}),this.generateLegend=function(t){var e,r,a,n,t=t||{},i=t.elementID||null,l=(t.style||"default",t.x||null),o=t.y||null,s=t.font||"arial, sans-serif";null==i?(e=B.append("g"),r=null!=l?l+p:.75*v,a=null!=o?o+p:.15*y):(n=d3.select(document.getElementById(i)).append("svg"),e=n.append("g"),r=0,a=0);for(var d=e.append("rect").attr("x",r).attr("y",a).attr("ry",10).attr("rx",10).attr("height",150).attr("width",150).attr("fill","white").attr("stroke","#c4c4c4").attr("stroke-width","1px").style("opacity",.7),h=0,f=[],u=[],c=0;c<A.length;c++){u[c]=e.append("rect").attr("x",r+10).attr("y",10+a+20*c).attr("width",10).attr("height",10).attr("fill",T[c]).style("z-index","99"),f[c]=e.append("text").attr("x",r+23).attr("y",19+a+20*c).text(L[c]).attr("fill","#000000").style({"font-size":"12px","z-index":"999999999","font-family":s});var g=f[c].node().getBBox();g.width>h&&(h=g.width)}return d.attr("height",29+20*(A.length-1)).attr("width",48+h),void 0!=n&&n.attr("width",d.attr("width")).attr("height",d.attr("height")),e}},this.createBarChart=function(t){function e(t){if(isNaN(t)){for(var e=[],r=0;r<t.length;r++){var a=new Date(t[r]);a=new Date(a.getTime()+6e4*a.getTimezoneOffset()),e[r]=a}return e}return t}function d(t){for(var e,a=0;a<t.length;a++){var n=t[a].reduce(function(t,e){return t+e},0);(n>e||null==e||void 0==e)&&(e=n)}var i=[b[0],b[1],0,e];if(0!=x.length){var l=d3.extent(x),o=r(c).domain([l[0],l[1]]).range([p,v]),s=o.invert(h(T,t)+p);if("time"==c){var d=new Date(l[0].getTime()-Math.abs(l[0]-s)),f=new Date(l[1].getTime()+Math.abs(l[0]-s));i=[d,f,0,e]}else i=[l[0]-s,l[1]+s,0,e]}return i}function h(t,e){if("auto"==t){var r=v/e.length*.55;return r>60?60:r}return t}function f(t){var t=t,e=h(T,t),r=h(T,g);if(G.length<t.length)for(var a=I||p,n=G.length;n<t.length;n++){D=D||0,E=D||0;var i=y,l=D+r+E;M[n]=B.append("g"),N=D+a,a+=l;for(var o=[],s=0;s<t[n].length;s++){var d=y-w(t[n][s]);i-=d,o[s]=M[n].append("rect").attr("y",i).attr("x",v+N).attr("height",d).attr("width",r).attr("fill",A[s])}void 0!=S&&(P[n]=S.createTooltipArea(t[n]).attr("y",i).attr("x",N+D).attr("height",d).attr("width",r)),G.push(o),I+=l}if(G.length>t.length){for(var f=G.length,n=t.length;f>n;n++){for(var s=0;s<g[n].length;s++)G[n][s].transition().duration(200).attr("y",y).attr("height",0).attr("width",e).attr("fill",A[s]),G[n][s].transition().delay(200).remove();void 0!=S&&(P[n].transition().duration(200).attr("y",y).attr("height",0).attr("width",e),P[n].transition().delay(200).remove())}G.splice(t.length,G.length-t.length)}for(var n=0;n<t.length;n++)if(t[n].length>G[n].length){for(var i=y,s=0;s<G[n].length;s++){var d=y-w(g[n][s]);i-=d}for(var s=G[n].length;s<t[n].length;s++)G[n].push(M[n].append("rect").attr("y",i).attr("x",G[n][0].attr("x")).attr("height",0).attr("width",e).attr("fill",A[s]))}g=t,D=(v-p-e*g.length)/(2*g.length),E=(v-p-e*g.length)/(2*g.length);for(var a=p,n=0;n<g.length;n++){var l,i=y;0==x.length?(l=D+e+E,N=D+a,a+=l):N=m(x[n])-e/2;for(var u=null,s=0;s<G[n].length;s++){if(!isNaN(i))var c=i;var d=y-w(t[n][s]);i-=d,void 0!=g[n][s]?(G[n][s].transition().duration(400).attr("y",i).attr("x",N).attr("height",d).attr("width",e),I=N):(G[n][s].transition().duration(400).attr("y",c).attr("x",N).attr("height",0).attr("width",e),G[n][s].transition().delay(400).remove(),(null==u||u>s)&&(u=s))}void 0!=P[n]&&(P[n].datum(g[n]),P[n].transition().duration(400).attr("y",i).attr("x",N).attr("height",y-i).attr("width",e)),null!=u&&G[n].splice(u,G[n].length)}}function u(){var t=d3.select("body").append("div").style({display:"flex","flex-direction":"row",position:"absolute","z-index":"10",opacity:0,font:"12px sans-serif","text-align":"left",padding:"4px","padding-left":"6px","padding-right":"0px","border-radius":"5px",width:"auto",height:"auto",background:"#fff","pointer-events":"none","box-shadow":"0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24)",border:"1px solid rgba(0, 0, 0, 0.24)"}),e=t.append("div").style({"z-index":"11","text-align":"left",width:"auto",height:"auto",background:"#fff",border:"0px solid green","pointer-events":"none"}).append("svg").style("margin-top","1px").attr("width","10px").style("border","0px solid purple"),r=t.append("div").style({"z-index":"11",font:"12px sans-serif","text-align":"left",width:"auto",height:"auto",background:"#fff","padding-left":"5px",border:"0px solid red",transform:"translate(0px, 0px)","pointer-events":"none"}),a=t.append("div").style({flex:"0","z-index":"15",width:"0px",height:"0px",background:"none","border-left":"11px solid transparent","border-right":"11px solid transparent","border-top":"11px solid rgba(0, 0, 0, 0.25)","pointer-events":"none"});a.append("div").style({flex:"0",position:"absolute","z-index":"1",width:"0px",height:"0px",background:"none","border-right":"9px solid transparent","border-left":"9px solid transparent","border-top":"9px solid #fff","pointer-events":"none",transform:"translate(-9px, -12px)"});return t.createTooltipArea=function(n){var i=[],l=B.append("rect").datum(n).attr("fill","#818181").attr("class","mouseOverArea").style("opacity",0).on("mouseover",function(n){var l=d3.select(event.target);l.style("opacity",.3);for(var o="",s=0,d=n.length-1;d>-1;d--)s+=n[d],o=o+z[d]+": "+n[d]+"<br/>";o=""+o+"Total: "+s,r.html(o),e.attr("height",14*n.length);for(var p=n.length-1,d=0;d<n.length;d++)i[d]=e.append("rect").attr("height",10).attr("width",10).attr("x","0px").attr("y",14*d+"px").attr("fill",A[p]),p--;var h=Number(t.style("width").slice(0,-2))/2,f=Number(t.style("height").slice(0,-2));a.style("transform","translate("+(-h+5)+"px,"+(f+4)+"px)"),t.style("left",d3.event.pageX-h+"px").style("top",d3.event.pageY-f-20+"px").style("opacity",.9).style("z-index","5")}).on("mousemove",function(e){var r=Number(t.style("width").slice(0,-2))/2,n=Number(t.style("height").slice(0,-2));a.style("transform","translate("+(-r+5)+"px,"+(n+4)+"px)"),t.style("left",d3.event.pageX-r+"px").style("top",d3.event.pageY-n-20+"px")}).on("mouseout",function(e){var r=d3.select(event.target);r.style("opacity",0),t.transition().duration(0).style("opacity",0)});return l},t}var t=t||{},g=t.data||[[0,0]],x=t.groupXValues||[],k=(t.type||"stacked",t.groupLabels||["Group 1","Group 2","Group 3","Group 4","Group 5"]),z=t.labels||["Bar 1","Bar 2","Bar 3","Bar 4","Bar 5"],A=t.colors||["#e35959","#5193ed","#409f2e","#b241d4","#e88e40"],T=t.barWidth||"auto",L=t.tooltipEnabled||!1,C=t.layer||0;x=e(x);var N,S,D,E,M=[],G=[],I=p,P=[],X=a(d,g);if(L)var S=u();b=n(),i(),l(),o([f,C]),s(g),u(),this.updateBarsStacked=function(t){var r;if(Array.isArray(t))r=t;else{var t=t||{};x=t.groupXValues||x,x=e(x),k=t.groupLabels||k,z=t.labels||z,A=t.colors||A,r=t.data||g}b=n(d(r),X),i(),l(),s(g),f(r),s(g)},this.generateLegend=function(t){var e,r,a,n,t=t||{},i=t.elementID||null,l=(t.style||"default",t.x||null),o=t.y||null,s=t.font||"arial, sans-serif";null==i?(e=B.append("g"),r=null!=l?l+p:.75*v,a=null!=o?o+p:.15*y):(n=d3.select(document.getElementById(i)).append("svg"),e=n.append("g"),r=0,a=0);for(var d=0,h=0;h<g.length;h++)d=g[h].length>d?g[h].length:d;for(var f=e.append("rect").attr("x",r).attr("y",a).attr("ry",10).attr("rx",10).attr("height",150).attr("width",150).attr("fill","#fff").attr("stroke","#c4c4c4").attr("stroke-width","1px").style("opacity",.7),u=0,c=[],x=[],h=0;d>h;h++){x[h]=e.append("rect").attr("x",r+10).attr("y",10+a+20*(d-1-h)).attr("width",10).attr("height",10).attr("fill",A[h]).style("z-index","99"),c[h]=e.append("text").attr("x",r+23).attr("y",19+a+20*(d-1-h)).text(z[h]).attr("fill","#000000").style({"font-size":"12px","z-index":"999999999","font-family":s});var b=c[h].node().getBBox();b.width>u&&(u=b.width)}f.attr("height",29+20*(d-1)).attr("width",48+u)}}};